# Rocky Cluster Automation
## The motivator
Rocky 9 is a preferred OS for running Openstack Kayobe (K.O.B.="Kolla on Bifrost").
[docs.openstack.org/kayobe/latest]("https://docs.openstack.org/kayobe/latest/")
In an effort to prepare a automated Openstack deployment training environment,
I needed to develop a small collection of tools to automate the provisioning of Rocky 
Linux nodes.

## The Components
- isc-dhcp-server: Yes, I know this project is no longer being maintained. I like it
  because  it has single-line host reservations.
- tftpd-hpa: TFTP gets your stage-1 boot files transferred to your PXE clients.
- nginx: we need to host a single file for anaconda-kickstart.

## Setup a Rocky Linux PXE installation
After starting up wizardlab with `vagrant up` issue `make keys` and than:
`$ make rocky_pxe`
Ansible configures the services host to provide the tftp, http, and dhcp services.
DHCP host reservations are generated by a dictionary variable.

## Cool server Bill, but what do I do with it?
This server does strange things with DHCP. The DHCP server gets the client to the
TFTP and via GRUB, the client is directed to web servers for installation images.
The automated installation turns a address in the `reserved_range` into a static
address, leaving servers with dynamic addresses dynamic.

You can edit the `rocky_pxe` dictionary variable under `playbooks/roles/rocky/vars/main.yml`
to reflect whatever ip address that you like. I have the following items configured for
my own development environment:
``
rocky_pxe:
  node0:
    ip_address: "192.168.56.12"
    mac_address: "de:ad:be:ef:00:00"
  node1:
    ip_address: "192.168.56.13"
    mac_address: "de:ad:be:ef:00:01"
  node2:
    ip_address: "192.168.56.14"
    mac_address: "de:ad:be:ef:00:02"
``
I manually create the VMs with virt-manager, and set the virtual adapters mac address to
match the values above. Host reservations are not required to PXE boot using the
dynamic pool.

The PXE grub menu defaults to a manual/graphical install, but you can tweak the
playbooks/roles/rocky/files/grub.cfg file to have it be fully automatic.
just change `set default="1"` to `set default="0"`.

The anaconda-ks.cfg file under playbooks/roles/rocky/files/anaconda-ks.cfg gets
distributed to pxe clients, and the Rocky network installer will foribly install
to the first detected disk. Use with caution.
